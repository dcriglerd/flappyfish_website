<analysis>**original_problem_statement:**
The user requested a Flappy Bird clone named Flappy Fish to be built as a React Native mobile application.

**PRODUCT REQUIREMENTS:**
1.  **Core Gameplay:** A Flappy Bird clone with tap-to-swim mechanics, built with React Native and Expo.
2.  **Monetization (Original):** The initial plan included real in-app purchases (IAPs) for coins and removing ads via RevenueCat, plus real in-game ads (Banner, Interstitial, Rewarded, App Open) via Google AdMob. **Note:** The IAP/Shop feature was later removed at the user's request.
3.  **Features:**
    *   Power-ups: Bubble Shield, Slow Motion, Coin Magnet, Double Coins.
    *   Customization: Unlockable fish skins.
    *   Cloud Data Sync: A FastAPI/MongoDB backend to save and load user progress (high score, coins, unlocks).
    *   Leaderboard: A UI to display global high scores from the backend.
    *   Achievements System: Unlockable achievements with notifications.
    *   Daily Rewards: A system for daily streaks and challenges to earn rewards.
    *   Push Notifications: Reminders for daily streaks.
4.  **Platform:** A React Native mobile app built with Expo, requiring a development build for full functionality.

**User's preferred language**: English

**what currently exists?**
A nearly complete React Native (Expo) mobile application located in  and a corresponding FastAPI backend in . The original web app and  directory are now obsolete references.

-   **Mobile App ():** Contains the core game logic, UI for all implemented features (Skins, Leaderboard, Achievements, Daily Rewards), sound effects, and integrations for Google AdMob. The project is set up for EAS Build.
-   **Backend ():** A live FastAPI server connected to MongoDB, with endpoints for saving/loading game data and providing leaderboard scores. It has been updated to support usernames.
-   **Removed Features:** The in-game Shop and the Remove Ads IAP functionality were recently removed at the user's request. Some cleanup may still be required.

**Last working item**:
-   Last item agent was working: Removing the Shop and Remove Ads sections from the application as requested by the user. The agent has removed the UI elements from  and .
-   Status: **IN PROGRESS**
-   Agent Testing Done: **N**
-   Which testing method agent to use? **Manual testing**. The next agent must build and run the app to verify the shop and related buttons are completely gone and that their removal has not caused any regressions.
-   User Testing Done: **N**

**All Pending/In progress Issue list**:
-   Issue 1: Fix Ad Scheduling (P0)
-   Issue 2: Remove remaining Shop/IAP code (P1)
-   Issue 3: Investigate Watch Ad to Revive inconsistency (P2)

**Issues Detail:**
-   **Issue 1: Fix Ad Scheduling**
    -   **Description:** The user reported that the ad scheduling is not working as implemented. The current logic is intended to show an interstitial ad every 3 game starts and every 5 game overs, but this is not behaving as expected.
    -   **Attempted fixes:** The agent created the  logic in  and added the  config. This fix was not successful according to the user.
    -   **Next debug checklist:**
        1.  Review the counters (, ) in .
        2.  Add console logs to trace when  and  are called and what the counter values are at those times.
        3.  Run the app in a dev client to manually test the ad frequency over at least 6 game starts and 10 game overs to observe the behavior directly.
    -   **Why fix this issue and what will be achieved with the fix?** To ensure ads are shown at a non-intrusive frequency that the user is happy with, improving player retention.
    -   **Status:** IN PROGRESS
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** Frontend (Mobile App)
-   **Issue 2: Remove remaining Shop/IAP code**
    -   **Description:** While the UI for the shop was removed, the underlying component files and context logic for IAPs likely still exist.
    -   **Next debug checklist:**
        1.  Delete the unused component file: .
        2.  Review  and remove all logic related to fetching offerings and making purchases. The context can be simplified to just handle the  state if needed elsewhere, or removed entirely if not.
        3.  Review  and remove the  function and any logic that checks the  status.
    -   **Why fix this issue and what will be achieved with the fix?** Reduces codebase complexity and removes dead code, making the app easier to maintain.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** Frontend (Mobile App)
-   **Issue 3: Investigate Watch Ad to Revive inconsistency**
    -   **Description:** The user reported that the rewarded ad for reviving the player is not working consistently.
    -   **Attempted fixes:** The agent added retry logic with exponential backoff and periodic preloading to .
    -   **Next debug checklist:**
        1.  Verify if this is still an issue after fixing the other ad scheduling problems.
        2.  Add extensive logging around the  and  functions in  to track loading state, errors, and show attempts.
    -   **Why fix this issue and what will be achieved with the fix?** A reliable revive mechanism improves player experience and provides an ad monetization opportunity.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** Frontend (Mobile App)

**In progress Task List**:
The pending issues cover all in-progress work.

**Upcoming and Future Tasks**
Future Tasks:
-   **Onboarding/Tutorial:** Add a simple tutorial for new players.
-   **Social Features:** Consider adding features like sharing high scores.

**Completed work in this session**
-   **Feature/Achievements & Cloud Sync:** Integrated the achievements system fully with the backend cloud sync.
-   **Feature/Daily Rewards:** Implemented a daily rewards system with streaks and challenges (, ).
-   **Feature/Push Notifications:** Added push notification reminders for daily streaks using Expo Notifications ().
-   **Feature/User Authentication:** Replaced the mock user ID with a persistent, device-based ID and added a username feature with a UI modal (, ).
-   **Backend/Username Support:** Updated the FastAPI backend () and database schema to store and display usernames on the leaderboard.
-   **Builds/EAS Project Migration:** Created a new, clean Expo project in , migrated all code, and successfully ran multiple EAS builds to generate APKs for user testing.
-   **Bugfix/Ad Interruptions:** Modified the ad system to prevent ads and achievement popups from interrupting active gameplay.

**Earlier issues found/mentioned but not fixed**
Covered in the **All Pending/In progress Issue list**.

**Known issue recurrence from previous fork**
None.

**Code Architecture**


**Key Technical Concepts**
-   **Frontend:** React Native, Expo (EAS Build), 
-   **Backend:** FastAPI, MongoDB
-   **State Management:** React Context API
-   **Integrations:**  (AdMob), , , 

**key DB schema**
-   **Collection:** 
    -    (Primary Key)
    -   
    -   
    -   
    -   
    -   
    -   
    -   

**changes in tech stack**
-    was added for push notification reminders.
-    was added for a more persistent device ID for authentication.

**All files of reference**
-   **Active Project Root:** 
-   **Ad Logic:** 
-   **Ad Config:** 
-   **Main Game Screen:** 
-   **App Entry Point:** 
-   **Backend Server:** 
-   **EAS Config:** 

**Areas that need refactoring**:
-   The EAS build process has been unreliable in the non-interactive environment, frequently timing out or failing. The  script approach has also been flaky. A more robust, command-line-driven build trigger is needed. Using  with pre-configured credentials might be a more stable path.

**key api endpoints**
-   : Create or update a user's game data.
-   : Retrieve a specific user's game data.
-   : Get the top players by high score.

**Critical Info for New Agent**
-   **Project Location:** The current and active project is . Do not use .
-   **Top Priority is Ad Bugs:** The user is primarily concerned with fixing the ad behavior. Address the Ad Scheduling and Revive Ad issues first.
-   **Shop Is Removed:** Do not attempt to fix or re-implement the IAP shop. The task is to complete its removal from the codebase.
-   **EAS Build Required:** All testing requires building a new APK via EAS. The last successful build command was .

**documents and test reports created in this job**
-   
-    (An  script for builds, which has been unreliable).

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Remove shop section and tje remove ads section. -> **Status: IN PROGRESS**. Agent started removal.
2.  **User:** The shop purchases aren't working and the ad scheduling isn't working as implemented. -> **Status: IN PROGRESS**. Shop issue is now a removal task. Ad scheduling is the highest priority bug.
3.  **User:** The watch ad to revive isn't working consistently and implement ads every few start overs. -> **Status: IN PROGRESS**. Agent implemented a fix, but it needs re-verification as the user is still reporting ad issues.
4.  **User:** Reduce frequency of achievement unlocked pop up. Its also interrupting gameplay. -> **Status: Completed**. Agent fixed this by queuing notifications.
5.  **User:** Regular gameplay is being interrupted by ads how can I change that. -> **Status: Completed**. Agent implemented a fix, but the core scheduling is still faulty.
6.  **User:**  -> **Status: Obsolete**. User provided a RevenueCat App ID. This led to the discovery that IAP was broken, and then the request to remove it.
7.  **User:** No (don't change package name) -> **Status: Completed**.
8.  **User:** What's google play package name -> **Status: Completed**. Agent provided the name.
9.  **User:** Implement real ads -> **Status: Completed**. Agent confirmed they were already live.
10. **User:**  (EAS Token) -> **Status: Completed**. Used to link the new project.

**Project Health Check:**
-   **Broken:** Ad scheduling logic. Potentially the watch ad to revive feature.
-   **Mocked:** None. The previously broken IAP system is now being removed.

**3rd Party Integrations**
-   **react-native-google-mobile-ads:** For Google AdMob ads. Configured with user's production keys.
-   **react-native-purchases:** For RevenueCat. This integration is being removed.
-   **expo-av:** For audio playback.
-   **expo-notifications:** For push notifications.
-   **expo-application:** For device-based user authentication.

**Testing status**
-   Testing agent used after significant changes: NO
-   Troubleshoot agent used after agent stuck in loop: NO
-   Test files created: []
-   Known regressions: The ad scheduling logic is not working as intended after the last modification.

**Credentials to test flow:**
-   **AdMob IDs:** Already configured in  and .

**What agent forgot to execute**
-   The agent did not complete the full removal of the shop/IAP feature; leftover files and code logic still need to be cleaned up.
-   The agent did not establish a reliable, non-interactive method for triggering EAS builds, resulting in multiple timeouts and failed attempts.</analysis>
